<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:of="http://omnifaces.org/functions"
	xmlns:ui="http://java.sun.com/jsf/facelets">


<div class="container">
	<h:form id="prestacaoContaForm" prependId="false"
		enctype="multipart/form-data">
		<!-- 		    <o:validateOne id="validateOne" components="foo bar baz" /> -->
		<p:messages id="messages" />
		<p:focus context="messages" />
		<p:panel header="#{wd['fieldset.data']}" toggleable="false"
			styleClass="clearfix" id="dadosPanel">
			<!-- 			<div class="row"> -->

			<!-- 			<div class="col-md-24"> -->
			<!-- 				<h:panelGrid columns="6" border="1" -->
			<!-- 					style="width:100%; text-align:center" -->
			<!-- 					rendered="#{prestacaoContaController.possuiEmpenho}"> -->
			<div class="col-md-24" style="text-align: left;">
				<p:dataTable id="empenhosDataTable" draggableColumns="true"
					emptyMessage="#{wd['item.emptyAddTable']}"
					value="#{prestacaoContaController.empenhos}" var="item"
					rendered="#{prestacaoContaController.possuiEmpenho}" reflow="true">

					<p:column id="colunaNumEmp" headerText="Nº Empenho"
						style="text-align:center">
						<h:outputLabel value="#{item.numero}" />
					</p:column>
					<p:column id="colunaDataEmp" headerText="#{lb['empenho.data']}"
						style="text-align:center">
						<h:outputText value="#{item.data}">
							<f:convertDateTime locale="pt,BR" dateStyle="long"
								pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>
					<p:column id="colunaValorEmp" headerText="Valor"
						style="text-align:center">
						<h:outputLabel value="#{item.valor}" />
					</p:column>
					<p:column id="colunaValorTotRepasse"
						headerText="Valor Total Repasses" style="text-align:center">
						<h:outputLabel value="#{item.valorTotalRepasse}" />
					</p:column>
					<p:column id="colunaValorTotPrestConta"
						headerText="Valor Total Prest. Contas" style="text-align:center">
						<h:outputLabel value="#{item.valorTotalPrestConta}" />
					</p:column>
					<p:column id="colunaSaldo" headerText="#{lb['liquidacao.saldo']}"
						style="text-align:center">
						<h:outputLabel value="#{item.saldo}" />
					</p:column>

					<!-- 					<h:outputLabel value="Nº Empenho" /> -->
					<!-- 					<h:outputLabel value="Data" /> -->
					<!-- 					<h:outputLabel value="Valor" /> -->
					<!-- 					<h:outputLabel value="Valor Total Repasses" /> -->
					<!-- 					<h:outputLabel value="Valor Total Prest. Contas" /> -->
					<!-- 					<h:outputLabel value="Saldo a Prestar" /> -->
					<!-- 					<h:outputLabel value="#{prestacaoContaController.empenho.numero}" /> -->
					<!-- 					<h:outputLabel value="#{prestacaoContaController.empenho.data}" /> -->
					<!-- 					<h:outputLabel value="#{prestacaoContaController.empenho.valor}" /> -->
					<!-- 					<h:outputLabel -->
					<!-- 						value="#{prestacaoContaController.empenho.valorTotalRepasse}" /> -->
					<!-- 					<h:outputLabel -->
					<!-- 						value="#{prestacaoContaController.empenho.valorTotalPrestConta}" /> -->
					<!-- 					<h:outputLabel value="#{prestacaoContaController.empenho.saldo}" /> -->

					<!-- 				</h:panelGrid> -->
				</p:dataTable>
			</div>
			<div class="col-md-24" style="text-align: left;">
				<p:dataTable id="liquidacoesDataTable" draggableColumns="true"
					emptyMessage="#{wd['item.emptyAddTable']}"
					value="#{prestacaoContaController.liquidacoes}" var="item"
					rendered="#{prestacaoContaController.possuiEmpenho}"
					scrollable="true" scrollHeight="100" reflow="true">

					<p:column id="colunaNumLiq" headerText="Nº Liquidação"
						style="text-align:center">
						<h:outputLabel value="#{item.numero}" />
					</p:column>
					<p:column id="colunaDataLiq" headerText="#{lb['liquidacao.data']}"
						style="text-align:center">
						<h:outputText value="#{item.data}">
							<f:convertDateTime locale="pt,BR" dateStyle="long"
								pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>
					<p:column id="colunaValorLiq"
						headerText="#{lb['liquidacao.valor']}" style="text-align:center">
						<h:outputLabel value="#{item.valor}" />
					</p:column>
					<p:column id="colunaValorPrestConta"
						headerText="#{lb['liquidacao.valorPrestConta']}"
						style="text-align:center">
						<h:outputLabel value="#{item.valorPrestConta}" />
					</p:column>
					<p:column id="colunaSaldo" headerText="#{lb['liquidacao.saldo']}"
						style="text-align:center">
						<h:outputLabel value="#{item.saldo}" />
					</p:column>
					<p:column id="colunaNumPrestConta" headerText="Prest. Contas Nº"
						style="text-align:center">
						<h:outputLabel value="#{item.numPrestConta}" />
					</p:column>
				</p:dataTable>
			</div>

			<!-- 			<div class="row"> -->
			<!-- 				<div class="col-md-2"> -->
			<!-- 					<p:outputLabel value="#{lb['prestacaoConta.dataPrestacao']}" -->
			<!-- 						for="dataPrestacao" /> -->
			<!-- 				</div> -->
			<!-- 				<div class="col-md-3"> -->
			<!-- 					<p:calendar id="dataPrestacao" -->
			<!-- 						value="#{prestacaoContaController.dataPrestacao}" -->
			<!-- 						pattern="dd/MM/yyyy" locale="pt" navigator="true" effect="fadeIn" -->
			<!-- 						required="true" readonlyInput="true" showOn="false" /> -->
			<!-- 				</div> -->
			<!-- 				<div class="col-md-3"> -->
			<!-- 					<p:outputLabel value="#{lb['prestacaoConta.totalRepasse']}" -->
			<!-- 						for="totalRepasse" /> -->
			<!-- 				</div> -->
			<!-- 				<div class="col-md-3" style="text-align: left;"> -->
			<!-- 					<p:outputLabel id="totalRepasse" -->
			<!-- 						value="#{prestacaoContaController.totalRepasse}" /> -->
			<!-- 				</div> -->
			<!-- 				<div class="col-md-4"> -->
			<!-- 					<p:outputLabel value="#{lb['prestacaoConta.saldoAberto']}" -->
			<!-- 						for="saldoAberto" /> -->
			<!-- 				</div> -->
			<!-- 				<div class="col-md-3" style="text-align: left;"> -->
			<!-- 					<p:outputLabel id="saldoAberto" -->
			<!-- 						value="#{prestacaoContaController.saldoAberto}" /> -->
			<!-- 				</div> -->
			<!-- 				<div class="col-md-3"> -->
			<!-- 					<p:outputLabel value="#{lb['prestacaoConta.saldoDisponivel']}" -->
			<!-- 						for="saldoDisponivel" /> -->
			<!-- 				</div> -->
			<!-- 				<div class="col-md-3" style="text-align: left;"> -->
			<!-- 					<p:outputLabel id="saldoDisponivel" -->
			<!-- 						value="#{prestacaoContaController.saldoDisponivel}" /> -->
			<!-- 				</div> -->
			<!-- 			</div> -->
			<!-- 			<div class="clear" /> -->
			<fieldset>
				<div
					style="background-color: #72A9D3; text-align: center; font-weight: bold; color: #FFF">
					<h:outputLabel
						value="Dados dos Documentos da Prestação de Contas Nº #{prestacaoContaController.liquidacoes.size()}" />
				</div>
				<br />
				<f:validateBean disabled="true">
					<div class="row">
						<div class="col-md-2">
							<p:outputLabel value="#{lb['prestacaoConta.tipoDoc']} Doc"
								for="tipoDoc" />
						</div>
						<div class="col-md-5">
							<p:inputText id="tipoDoc"
								value="#{prestacaoContaController.documento.tipo}"
								required="true" immediate="true">
								<!-- 					<f:convertNumber type="number" minFractionDigits="1" pattern="#0.000" minIntegerDigits="0" /> -->
							</p:inputText>
						</div>
						<div class="col-md-2">
							<p:outputLabel value="#{lb['prestacaoConta.numDoc']}"
								for="numDoc" />
						</div>
						<div class="col-md-5">
							<p:inputText id="numDoc"
								value="#{prestacaoContaController.documento.numero}"
								required="false">
							</p:inputText>
						</div>
						<div class="col-md-1">
							<p:outputLabel value="#{lb['prestacaoConta.dataPrestacao']}"
								for="prestContaData" />
						</div>
						<div class="col-md-3">
							<p:calendar id="prestContaData"
								value="#{prestacaoContaController.documento.data}"
								showOn="button" pattern="dd/MM/yyyy" locale="pt"
								navigator="true" effect="fadeIn" required="true" />
						</div>
						<div class="col-md-2">
							<p:outputLabel value="#{lb['prestacaoConta.valorDoc']}"
								for="valorDoc" />
						</div>
						<div class="col-md-4">
							<p:inputText id="valorDoc"
								value="#{prestacaoContaController.valorDoc}" required="true"
								immediate="true" onkeypress="mascara(this,currency);">
							</p:inputText>
						</div>
					</div>
					<div class="row">
						<div class="col-md-2" style="margin-top: 10px;">
							<p:outputLabel value="#{lb['prestacaoConta.arquivo']}"
								for="arquivoNomeFileUpload" />
						</div>
						<div class="col-md-17" style="margin-top: 10px;">
							<p:inputText id="arquivoNomeFileUpload"
								widgetVar="arquivoNomeFileUpload"
								value="#{prestacaoContaController.arquivoUploadFile != null ? prestacaoContaController.arquivoUploadFile.fileName : ''}"
								disabled="false" readonly="true" required="true"
								onclick="clickUploadFile();"
								binding="#{prestacaoContaController.arquivoNomeFileUpload}" />
						</div>
						<div class="col-md-5" style="text-align: left; padding-left: 0px">
							<p:fileUpload id="arquivoFileUpload" label=" Selecionar Arquivo"
								update="arquivoNomeFileUpload @this :prestacaoContaTabView:prestacaoContaForm:documentosDataTable :prestacaoContaTabView:prestacaoContaForm:messages"
								styleClass="uploadFile" showButtons="true"
								fileUploadListener="#{prestacaoContaController.uploadDoArquivoEvent}"
								immediate="true" auto="true"
								allowTypes="/(\.|\/)(gif|jpe?g|png|pdf)$/" />
						</div>
					</div>
				</f:validateBean>
				<div class="clear" />
				<p:commandButton id="adicionarCommandButton" value="Salvar"
					icon="ui-icon-disk"
					process="@this :prestacaoContaTabView:prestacaoContaForm:tipoDoc, :prestacaoContaTabView:prestacaoContaForm:numDoc, :prestacaoContaTabView:prestacaoContaForm:valorDoc, :prestacaoContaTabView:prestacaoContaForm:prestContaData, :prestacaoContaTabView:prestacaoContaForm:arquivoNomeFileUpload"
					update="messages documentosDataTable :prestacaoContaTabView:prestacaoContaForm:tipoDoc, :prestacaoContaTabView:prestacaoContaForm:numDoc, :prestacaoContaTabView:prestacaoContaForm:valorDoc, :prestacaoContaTabView:prestacaoContaForm:prestContaData, :prestacaoContaTabView:prestacaoContaForm:arquivoNomeFileUpload, :prestacaoContaTabView:prestacaoContaForm:arquivoNomeFileUpload"
					action="#{prestacaoContaController.salvarArquivo}"
					styleClass="w3 r8" style="margin: 5px 5px 5px 5px" />
				<!-- 					:prestacaoContaTabView:prestacaoContaForm:saldoAberto, -->

				<!-- 					selection="#{prestacaoContaController.documentosSelected}" rowKey="#{item.id}"-->
				<p:dataTable id="documentosDataTable" draggableColumns="true"
					emptyMessage="#{wd['item.emptyAddTable']}"
					value="#{prestacaoContaController.documentos}" var="item"
					reflow="true">

					<p:column id="colunaTipoDoc"
						headerText="#{lb['prestacaoConta.tipoDoc']}">
						<h:outputLabel value="#{item.tipo}" />
					</p:column>
					<p:column id="colunaNumDoc"
						headerText="#{lb['prestacaoConta.numDoc']}">
						<h:outputLabel value="#{item.numero}" />
					</p:column>
					<p:column id="colunaValorDoc"
						headerText="#{lb['prestacaoConta.valorDoc']}">
						<h:outputLabel value="#{item.valor}">
							<f:convertNumber type="currency" currencyCode="BRL" />
						</h:outputLabel>
					</p:column>
					<p:column id="colunaDataDoc" headerText="Data">
						<h:outputText value="#{item.data}">
							<f:convertDateTime locale="pt,BR" dateStyle="long"
								pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>
					<p:column id="colunaArquivo"
						headerText="#{lb['prestacaoConta.arquivo']}">
						<h:outputLabel value="#{item.nome}" />
					</p:column>
					<p:column id="colunaOpcao"
						headerText="#{wd['table.columns.options']}"
						style="width:100px; text-align: center;">
						<p:commandButton id="editarCommandButton" icon="ui-icon-pencil"
							process="@this documentosDataTable"
							action="#{prestacaoContaController.editarDoc}"
							title="#{wd['table.columns.options.edit.hint']}"
							update=":prestacaoContaTabView:prestacaoContaForm"
							styleClass="icon">
							<!-- 								<f:setPropertyActionListener -->
							<!-- 									target="#{prestacaoContaController.documento}" value="#{item}" /> -->
							<f:setPropertyActionListener
								target="#{prestacaoContaController.documentoEdite}"
								value="#{item}" />
							<p:collector value="#{prestacaoContaController.documentoEdite}"
								removeFrom="#{prestacaoContaController.documentos}" />
						</p:commandButton>

						<p:commandButton id="removerCommandButton" icon="ui-icon-trash"
							title="#{wd['table.columns.options.delete.hint']}"
							onclick="PF('removeConfirmDialog').show()"
							process="@this documentosDataTable" styleClass="icon">
							<p:confirm header="#{wd['dialog.deleteConfirmation.header']}"
								message="#{wd['dialog.deleteConfirmation.message']}"
								icon="ui-icon-alert" />
							<f:setPropertyActionListener
								target="#{prestacaoContaController.documentoRemove}"
								value="#{item}" />
						</p:commandButton>

						<p:commandButton id="exibirCommandButton" icon="ui-icon-image"
							title="#{wd['table.columns.options.show.hint']}" process="@this"
							styleClass="icon"
							action="#{prestacaoContaController.visualizarArquivo}" update="@form :prestacaoContaTabView:prestacaoContaForm:imageStreamDialog">
							<f:setPropertyActionListener
								target="#{prestacaoContaController.documentoExibe}"
								value="#{item}" />
						</p:commandButton>

					</p:column>

					<!-- 					<p:column selectionMode="multiple" -->
					<!-- 						style="width:10px; text-align:center" /> -->

					<f:facet name="footer">
						<div style="text-align: left;">
							<h:outputLabel
								value="Valor Total: #{prestacaoContaController.valorTotal}">
								<!-- 									<f:convertNumber type="currency" currencyCode="BRL" /> -->
							</h:outputLabel>
						</div>
						<!--         In total there are #{fn:length(dtBasicView.cars)} cars. -->
					</f:facet>

				</p:dataTable>
				<!-- 				</p:outputPanel> -->
			</fieldset>
			<!-- 			<p:commandButton value="Salvar" update="@form" process="@this" -->
			<!-- 				action="#{prestacaoContaController.salvarPrestacaoConta}" -->
			<!-- 				styleClass="w3 r8" style="margin: 5px 5px 5px 5px"  icon="ui-icon-disk" -->
			<!-- 				id="salvarCommandButton" /> -->
			<div class="clear" />

		</p:panel>
		<div class="row">
			<!-- 		:prestacaoContaTabView:prestacaoContaForm:dataPrestacao, :prestacaoContaTabView:prestacaoContaForm:totalRepasse, :prestacaoContaTabView:prestacaoContaForm:saldoAberto -->
			<p:commandButton value="Finalizar" update=":prestacaoContaTabView"
				process="@this" styleClass="col-md-4 r6" icon="ui-icon-disk"
				id="cadastrarCommandButton"
				action="#{prestacaoContaController.mostrarDialogPrestConta}"
				actionListener="#{prestacaoContaController.closeEditTab}">
				<!-- 				action="#{prestacaoContaController.registrar}" -->
			</p:commandButton>
			<p:commandButton id="limparCommandButton"
				value="#{wd['button.clean']}" icon="ui-icon-arrowrefresh-1-w"
				actionListener="#{prestacaoContaController.init}" update="@form"
				process="@this" styleClass="col-md-4 r7">
			</p:commandButton>
		</div>
		<div class="clear" />
		<br />
		<fieldset>
			<LEGEND>Observação:</LEGEND>
			<DIV style="font-weight: bold; color: red;">
				<h:outputLabel>Caso o documento possua numeração informe-o no campo número, caso não haja, o sistema gerará um número para o seu documento.</h:outputLabel>
			</DIV>
		</fieldset>

		<p:confirmDialog id="removeConfirmDialog"
			widgetVar="removeConfirmDialog" global="true">
			<p:commandButton value="#{wd['dialog.optionYes']}" styleClass="r6"
				icon="ui-icon-check" oncomplete="PF('removeConfirmDialog').hide()"
				process="@parent documentosDataTable"
				action="#{prestacaoContaController.removerDoc}"
				update=":prestacaoContaTabView:prestacaoContaForm:documentosDataTable">
				<!-- 				, :prestacaoContaTabView:prestacaoContaForm:saldoAberto -->
				<p:collector value="#{prestacaoContaController.documentoRemove}"
					removeFrom="#{prestacaoContaController.documentos}" />
			</p:commandButton>
			<p:commandButton onclick="PF('removeConfirmDialog').hide()"
				styleClass="r6" icon="ui-icon-cancel"
				value="#{wd['dialog.optionNo']}" type="button" />
		</p:confirmDialog>

		<p:confirmDialog id="confirmFinalizarDialog"
			widgetVar="confirmFinalizarDialog" global="true" header="Alerta"
			message="Deseja Realmente Finalizar esta Prestação de Contas?">
			<div style="font-weight: bold;">
				<h:outputLabel id="mensagemPrestContaLabel"
					value="#{prestacaoContaController.messagemPrestacaoContas}"
					style="width:400px; text-align:center;text" />
			</div>
			<br />
			<p:commandButton id="yesCommandButton" widgetVar="yesCommandButton"
				value="#{wd['dialog.optionYes']}" styleClass="r6"
				icon="ui-icon-check" onclick="PF('confirmFinalizarDialog').hide();"
				process="@this" action="#{prestacaoContaController.registrar}"
				update=":prestacaoContaTabView">
				<!-- 				, :prestacaoContaTabView:prestacaoContaForm:saldoAberto -->
				<p:blockUI block=":prestacaoContaTabView" trigger="yesCommandButton">
					<h:outputLabel value="#{wd['blockui.loading.text']}" />
					<br />
					<h:graphicImage library="images"
						name="#{wd['blockui.loading.img']}" />
				</p:blockUI>
			</p:commandButton>
			<p:commandButton onclick="PF('confirmFinalizarDialog').hide();"
				styleClass="r6" icon="ui-icon-cancel"
				value="#{wd['dialog.optionNo']}" type="button" />
		</p:confirmDialog>

		<p:dialog widgetVar="imageStreamDialog" id="imageStreamDialog"
			height="500px" width="800px" resizable="false">
			<p:graphicImage value="#{prestacaoContaController.imageStream}"
				height="500px" width="800px"
				rendered="#{prestacaoContaController.imageStream eq null ? false : true}" />
			<p:media id="pdfView" player="pdf"
				binding="#{prestacaoContaController.pdfView}" height="500px"
				width="800px"
				rendered="#{prestacaoContaController.imageStream eq null ? true : false}" />
			<!--     value="../images/#{imgBean.selectedBook.imagePath}.png" -->
		</p:dialog>
	</h:form>
</div>
</html>