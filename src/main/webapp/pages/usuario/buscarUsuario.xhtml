<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<div class="container">
	<h:form id="buscarUsuarioForm" prependId="false">
		<p:messages id="messages" />

		<p:panel header="#{wd['fieldset.filters']}" toggleable="true"
			id="filtersPanel" styleClass="clearfix">
			<f:validateBean disabled="true">
				<!-- linha -->
				<div class="row">
					<div class="col-md-2">
						<p:outputLabel for="nameInputText"
							value="#{lb['userSystem.name']}" />
					</div>
					<div class="col-md-6">
						<p:inputText id="nameInputText"
							value="#{buscarUserController.userBusca.name}" />
					</div>
					<div class="col-md-2">
						<p:outputLabel for="loginInputText"
							value="#{lb['userSystem.username']}" />
					</div>
					<div class="col-md-6">
						<p:inputText id="loginInputText"
							value="#{buscarUserController.userBusca.username}" />
					</div>
					<div class="col-md-2">
						<p:outputLabel value="Perfil" for="roleEditeAC" />
					</div>
					<div class="col-md-6">
						<p:autoComplete id="roleEditeAC"
							value="#{buscarUserController.roleBusca}"
							completeMethod="#{userController.autocompletarRole}"
							converter="autocompleteConverter" var="var"
							itemLabel="#{var.name}" itemValue="#{var}" dropdown="true"
							scrollHeight="250">
							<p:ajax event="itemSelect" process="@this"
								disabled="#{loginController.principalRole eq 'ADMIN' ? false : true}" />
							<f:attribute name="entityClass"
								value="br.com.sts.ddum.model.springsecurity.entities.Role" />
						</p:autoComplete>
					</div>
				</div>
				<div class="clear" />
			</f:validateBean>
		</p:panel>

		<p:commandButton value="#{wd['button.search']}"
			action="#{buscarUserController.buscar}" icon="ui-icon-search"
			id="searchCommandButton" styleClass="col-md-4 r6"
			update="buscarUsuarioTable" process="@this">
			<p:blockUI block="buscarUsuarioTable" trigger="searchCommandButton">
					<h:outputLabel value="#{wd['blockui.loading.text']}" />
					<br />
					<h:graphicImage library="images" name="#{wd['blockui.loading.img']}" />
				</p:blockUI>
			</p:commandButton>
		<p:commandButton value="#{wd['button.clean']}" process="@this"
			action="#{buscarUserController.init}" update="filtersPanel"
			icon="ui-icon-arrowrefresh-1-w" id="clearCommandButton"
			styleClass="col-md-4 r7">
		</p:commandButton>
		<div class="clear" />
		<fieldset>
			<legend>Resultados</legend>
			<p:dataTable value="#{buscarUserController.usuarios}"
				currentPageReportTemplate="{currentPage} de {totalPages}"
				emptyMessage="#{wd['item.emptyFind']}" var="usuario"
				id="buscarUsuarioTable" paginator="true" rows="5"
				paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">

				<p:column headerText="#{lb['userSystem.name']}"
					style="width: 250px; text-align: center; white-space:normal !important;">
					<h:outputText value="#{usuario.name}" />
				</p:column>
				<p:column headerText="#{lb['userSystem.username']}"
					style="width: 150px; text-align: center;">
					<h:outputText value="#{usuario.username}" />
				</p:column>
				<p:column headerText="Perfil"
					style="width: 100px; text-align: center;">
					<h:outputText value="#{usuario.getRoles().iterator().next().name}" />
				</p:column>
				<p:column headerText="#{lb['userSystem.createDate']}"
					style="width: 100px; text-align: center;">
					<h:outputText value="#{usuario.createdAt}">
						<f:convertDateTime locale="pt,BR" dateStyle="long"
							pattern="dd/MM/yyyy" />
					</h:outputText>
				</p:column>
				<p:column headerText="#{wd['table.columns.options']}"
					style="width:50px; ; text-align: center;">
					<p:commandButton icon="ui-icon-trash"
						action="#{buscarUserController.verificarPermissao}"
						styleClass="icon"
						title="#{wd['table.columns.options.delete.hint']}" update="@form">
						<f:setPropertyActionListener
							target="#{buscarUserController.userRemove}" value="#{usuario}" />
<!-- 						<p:confirm header="#{wd['dialog.deleteConfirmation.header']}" -->
<!-- 							message="#{wd['dialog.deleteConfirmation.message']}" -->
<!-- 							icon="ui-icon-alert" /> -->
					</p:commandButton>
					<p:commandButton icon="ui-icon-pencil" styleClass="icon"
						action="#{buscarUserController.carregar}" update=":usuarioTabView"
						process="@form" title="#{wd['table.columns.options.edit.hint']}">
						<f:setPropertyActionListener
							target="#{buscarUserController.userEdite}" value="#{usuario}" />
					</p:commandButton>
				</p:column>
				
			</p:dataTable>
		</fieldset>

		<!-- 			message="#{wd['dialog.deleteConfirmation.message']}" -->
		<!-- 			header="#{wd['dialog.deleteConfirmation.header']}" -->
		<p:confirmDialog id="confirmation" widgetVar="confirmation"
			global="true" header="#{wd['dialog.deleteConfirmation.header']}" message="#{wd['dialog.deleteConfirmation.message']}">
			<p:commandButton id="btnSim" icon="ui-icon-check"
				value="#{wd['dialog.optionYes']}"
				oncomplete="PF('confirmation').hide()"
				action="#{buscarUserController.remover}"
				update="buscarUsuarioTable messages" process="@this" styleClass="r6" />
			<p:commandButton id="btnNao" onclick="PF('confirmation').hide()"
				icon="ui-icon-cancel" value="#{wd['dialog.optionNo']}"
				styleClass="r6" type="button" />
		</p:confirmDialog>
	</h:form>
</div>
</html>